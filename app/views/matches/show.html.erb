<div class="banner d-flex align-items-center justify-content-center" style="background: url(<%= (cl_image_tag @match.photo).match(/http\:(.)*"/)[0].gsub(/\"/, "") %>) no-repeat center center; background-size: cover; height: 70vh" >
  <div>
    <h1 class="text-center" style="color: white"><%= @match.description %></h1>
    <p class="text-center" style="color: white"><%= @match.city %></p>
  </div>
</div>

<div class="container">
  <div class="py-5">
    <div class="row border rounded mt-5 mb-2 mx-0 p-3" style="">
      <div class="col-5">
        <p><b>Event details</b></p>
        <p style="font-size: 14px">Location: <%= @match.location %></p>
        <p style="font-size: 14px">Date & Time: <%= @match.date.strftime("%d/%m/%Y") %> -  <%= @match.time.strftime("%H:%M") %></p>
        <% if (@match.date - Date.today).to_i >= 0 %>
          <p style="font-size: 14px">Coming in: <%= (@match.date - Date.today).to_i %> days</p>
        <% end %>
        <p style="font-size: 14px">Level: <%= @match.level %></p>
        <p class="mb-0", style="font-size: 14px">Max Players: <%= @match.number_of_players %></p>
      </div>
      <div class="col-7">
      <h5><strong>Team A</strong></h5>
      <div class="d-flex mb-5 round-plus-button">
        <% @players_a.each do |player| %>
          <% if player.status == "pending" %>
            <%= cl_image_tag player.user.photo, class: "pending rounded-circle mt-1", style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% else %>
            <%= cl_image_tag player.user.photo, class: "rounded-circle mt-1", style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% end %>
        <% end %>
        <!-- add button -->
        <% unless ( @all_players.any?{|user| user == current_user} || @players_a.count >= (@match.number_of_players / 2) || @match.status != "open" ) %>
          <%= link_to "", match_players_path(@match, player: {team: 'A'}), method: :post, data: { confirm: 'Are you sure you want to join the team A?' }, class: "fas fa-plus-circle" %>
        <% end %>
      </div>
      <h5><strong>Team B</strong></h5>
      <div class="d-flex round-plus-button">
        <% @players_b.each do |player| %>
          <% if player.status == "pending" %>
            <%= cl_image_tag player.user.photo, class: "pending rounded-circle mt-1", style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% else %>
            <%= cl_image_tag player.user.photo, class: "rounded-circle mt-1", style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% end %>
        <% end %>
        <!-- add button -->
        <% unless ( @all_players.any?{|user| user == current_user} || (@players_b.count >= @match.number_of_players) || @match.status != "open" ) %>
          <%= link_to "", match_players_path(@match, player: {team: 'B'}), method: :post, data: { confirm: 'Are you sure you want to join the team B?' }, class: "fas fa-plus-circle" %>
        <% end %>
      </div>
      </div>
    </div>
  </div>

  <div>
    <% if current_user %>
      <% if @match.user == current_user %>
        <%= link_to "Edit", edit_match_path(@match), class: "btn btn-outline-success" %>
        <%= link_to "Cancel", match_path(@match), method: :delete, class: "btn btn-outline-danger" %>
      <% end %>
    <% end %>

    <!-- WINNER -->
    <% if @match.user == current_user && @match.status == "past" %>
      <h2 class="mt-5">Who is the winner :</h2>
      <% if @match.winner.nil? %>
        <%= link_to "Team A", match_winner_path(@match, match: {winner: 'A'}), method: :post, data: { confirm: 'Are you sure you want to choose the team A?' }, class: "btn btn-success" %>
        <%= link_to "Team B", match_winner_path(@match, match: {winner: 'B'}), method: :post, data: { confirm: 'Are you sure you want to choose the team B?' }, class: "btn btn-danger" %>
        <%= link_to "Draw", match_winner_path(@match, match: {winner: 'Draw'}), method: :post, data: { confirm: 'Are you sure you want to choose draw?' }, class: "btn btn-primary" %>
        <% else %>
        <p>Team : <%= @match.winner %> </p>
      <% end %>
    <% end %>

    <!-- SHOW CHALLENGE REQUEST -->
    <% unless @challenges == [] %>
      <% if @challenges[0].match_id == @match.id %>
        <h2 class="text-center mt-5">ðŸ‘ŠðŸ‘ŠðŸ‘Š You Have a Challenge! ðŸ‘ŠðŸ‘ŠðŸ‘Š</h2>
        <h4 class="text-center mb-1 challenge-found">Challenger: <%= cl_image_tag @challenger.photo, class: "rounded-circle mt-1", style: "margin-left: 20px; width: 50px; height: 50px; object-fit: cover;" %> <%= link_to @challenger.name, profile_path(@challenger) %></h4>
        <div class="pb-4 challenge-btns d-flex justify-content-center">
          <div class="col-sm-12 col-md-10 p-0 mt-3">
            <%= link_to "Sorry, I'm a coward", player_path(@challenges[0], challenge: { status: 'declined' }), class: "btn btn-danger", method: :put %>
            <%= link_to "Bring it on!", player_path(@challenges[0], challenge: { status: 'accepted' }), class: "btn btn-primary", method: :put %>
          </div>
        </div>
      <% end %>
    <% end %>

    <!-- Challenge buddy -->
    <% if @all_players.any?{|user| user == current_user} && user_signed_in? && !@match.full? && current_user.friends != [] %>
    <h2 class="text-center mb-1 mt-5">ðŸ‘Š Challenge Your Buddy ðŸ‘Š</h2>
    <div class="pb-4 challenge d-flex justify-content-center">
      <div class="col-sm-12 col-md-10 p-0">
        <%= simple_form_for [@match, @player] do |f| %>
          <%= f.input :user_id, label: "Choose your buddy:", include_blank: false, collection: @friends %>
          <%= f.submit "Challenge!", class: "btn btn-success" %>
        <% end %>
      </div>
    </div>
    <% end %>
  </div>

  <!-- COMMENTS -->
  <h2 class="text-center mb-1 mt-5">Write a comment</h2>
  <div class="row justify-content-center">
    <div class="col-10">
      <div class="text-center">
      <% if policy(@forum).create? %>
        <%= simple_form_for [@match, @forum] do |f| %>
          <%= f.input :content, label: "Write your comment here:"%>
          <%= f.submit "save", class: "btn btn-success mt-0 mb-4", id: "refresh" %>
        <% end %>
      <% end %>
      </div>
      <div class="text-center">
        <div class="border" style="margin: 10vh 0; margin-top: 20px;padding: 20px;">
        <div id='forumstart'></div>
          <% if @forums != [] %>

            <% @forums.each do |comment| %>
            <% dayCount = (Time.new(Time.now - comment.created_at).day) -1 %>
            <div class="m-3 comments">
              <!-- IF DAYS == 0 THEN DONT SHOW DAYS -->
              <h5 class="m-0">
                <!-- TODO: CHANGE NAME INTO LINK TO USER -->
                <%= link_to comment.user.name.split(" ").first, profile_path(comment.user) %>
                <% if dayCount != 0 %> - <%= dayCount unless dayCount == 0 %> days ago<% else %>
                 - <%= comment.created_at.strftime("%H:%M") %> UTC
                 <% end %></h5>
              <p class="m-0"> <%= comment.content %> </p>
            </div>
            <% end %>
          <% else %>
            <div class="m-3 comments">
              <!-- IF DAYS == 0 THEN DONT SHOW DAYS -->
              <h5 class="m-0">"There is no comments"</h5>
            </div>
          <% end %>
        </div>
      </div>
    </div>
</div>
