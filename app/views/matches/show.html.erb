<!-- Find me in app/views/matches/show.html.erb -->
<div class="banner d-flex align-items-center justify-content-center" style="background: url(https://images.unsplash.com/photo-1555160679-b1b58488f476?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1489&q=80) no-repeat center center; background-size: cover; height: 70vh" >

  <div>
    <h1 class="text-center" style="color: white">Matches#show</h1>
    <p class="text-center" style="color: white"><%= @match.description %></p>
  </div>
</div>

<div class="container">
  <div class="row border rounded mt-5 mb-2 mx-0 p-3" style="">
    <div class="col-8">
      <p><b>Event details</b></p>
      <p>Where: <%= @match.location %></p>
      <p>When: <%= @match.date %></p>
      <p>At: <%= @match.time %></p>
      <p>Level: <%= @match.level %></p>
      <p class="mb-0">Max Players: <%= @match.number_of_players %></p>
    </div>
    <div class="col-4">
      <div class="mb-5"><b>Team A</b>
        <br>
        <% @players_a.each do |player| %>
          <%= cl_image_tag player.user.photo %>
        <% end %>
      </div>
      <div class=""><b>Team B</b>
        <br>
        <% @players_b.each do |player| %>
          <%= cl_image_tag player.user.photo %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="mb-2">
    <%= link_to "Edit", edit_match_path(@match), class: "btn btn-outline-success" %>
    <%= link_to "Delete", match_path(@match), method: :delete, class: "btn btn-outline-danger" %>
    <%= link_to "Matches", matches_path, class: "btn btn-success" %>

    <!-- TODO: DESIGN -->

    <% @array_A = @players_a.map do |player| %>
    <% player.user %>
    <% end %>

    <% @array_B = @players_b.map do |player| %>
    <% player.user %>
    <% end %>

    <% if @array_A.any?{|user| user == current_user} %>
      <%= link_to "Join team A", match_players_path(@match, player: {team: 'A'}), method: :post, data: { confirm: 'Are you sure you want to join the team A?' },class: "btn btn-success disabled" %>
      <%= link_to "Join team B", match_players_path(@match, player: {team: 'B'}), method: :post, data: { confirm: 'Are you sure you want to join the team B?' },class: "btn btn-success disabled" %>

      <% elsif @array_B.any?{|user| user == current_user} %>
        <%= link_to "Join team A", match_players_path(@match, player: {team: 'A'}), method: :post, data: { confirm: 'Are you sure you want to join the team A?' },class: "btn btn-success disabled" %>
        <%= link_to "Join team B", match_players_path(@match, player: {team: 'B'}), method: :post, data: { confirm: 'Are you sure you want to join the team B?' },class: "btn btn-success disabled" %>

    <% else %>

      <% if @players_a.count >= @match.number_of_players %>
        <%= link_to "Join team A", match_players_path(@match, player: {team: 'A'}), method: :post, data: { confirm: 'Are you sure you want to join the team A?' },class: "btn btn-success disabled" %>
      <% else%>
        <%= link_to "Join team A", match_players_path(@match, player: {team: 'A'}), method: :post, data: { confirm: 'Are you sure you want to join the team A?' },class: "btn btn-success" %>
      <% end %>

      <% if @players_b.count >= @match.number_of_players %>
        <%= link_to "Join team B", match_players_path(@match, player: {team: 'B'}), method: :post, data: { confirm: 'Are you sure you want to join the team B?' },class: "btn btn-success disabled" %>
      <% else%>
        <%= link_to "Join team B", match_players_path(@match, player: {team: 'B'}), method: :post, data: { confirm: 'Are you sure you want to join the team B?' },class: "btn btn-success" %>
        <% end %>

      <% end %>
  </div>
</div>

<h2 class="text-center mb-4 mt-5">Comments</h2>


<div class="text-center mb-5">
  <% @forums.each do |comment| %>
    <p> <%= comment.content %> </p>
  <% end %>
</div>
<div class="text-center mb-5">
  <%= link_to "add a comment", new_match_forum_path(@match),class: "", style: "text-decoration: underline; color: blue" %>
</div>
